<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REZoom - ATS Resume Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="container bg-white p-8 rounded-2xl shadow-2xl w-full max-w-lg transition-all duration-300 transform hover:scale-[1.01] hover:shadow-3xl">
        <header class="flex flex-col items-center mb-6">
            <svg class="w-16 h-16 text-blue-600 mb-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zM12 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                <path d="M18.36 5.64C16.92 4.19 14.5 3.33 12 3.33v1.33c2.14 0 4.14.86 5.66 2.37L18.36 5.64zM5.64 5.64L7.05 7.05C5.8 8.28 5 9.94 5 12h-1.33c0-2.5 1.15-4.83 3.01-6.42zM3.33 12c0 2.5 1.15 4.83 3.01 6.42l-1.42 1.41C4.08 18.36 3.33 16.03 3.33 12H3.33zM12 20.67v-1.34c2.15 0 4.14-.86 5.66-2.37l1.42 1.42C18.36 19.81 16.03 20.67 12 20.67z"/>
            </svg>
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">REZoom</h1>
            <p class="text-center text-gray-500 mb-2">Your AI-Powered ATS Resume Analyzer</p>
        </header>

        <p class="text-center text-gray-700 mb-8">Upload your resume (PDF or Word) to get an instant ATS score and tailored recommendations.</p>

        <form id="resumeUploadForm" class="flex flex-col items-center space-y-4">
            <label for="resumeFile" class="w-full text-center cursor-pointer">
                <span class="inline-block w-full px-6 py-3 rounded-full text-white font-semibold bg-blue-600 hover:bg-blue-700 transition-colors shadow-md">
                    Choose File
                </span>
                <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" required class="hidden">
            </label>
            <span id="fileName" class="text-gray-500 text-sm italic">No file selected</span>
            
            <button type="submit" class="w-full px-6 py-3 rounded-full bg-green-500 text-white font-bold shadow-lg hover:bg-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2 mt-4">
                Analyze Resume
            </button>
        </form>

        <!-- Loading and Status Messages -->
        <div id="loadingMessage" class="hidden mt-6 text-center text-blue-500 font-medium animate-pulse">
            <div class="flex items-center justify-center">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Analyzing your resume...
            </div>
        </div>
        <div id="statusMessage" class="hidden mt-6 text-center font-medium text-gray-700"></div>

        <!-- Results Display -->
        <div id="results" class="hidden mt-8 text-left border-t pt-6 border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Your ATS Analysis</h2>
            
            <div class="mb-6 bg-gray-50 p-4 rounded-lg">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Personal Data</h3>
                <ul class="text-gray-600 space-y-1 text-sm">
                    <li><strong>Name:</strong> <span id="personalName" class="font-medium"></span></li>
                    <li><strong>Email:</strong> <span id="personalEmail" class="font-medium"></span></li>
                    <li><strong>Phone:</strong> <span id="personalPhone" class="font-medium"></span></li>
                </ul>
            </div>
            
            <div class="mb-6 bg-gray-50 p-4 rounded-lg">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">ATS Scores</h3>
                <ul class="text-gray-600 space-y-4">
                    <li>
                        <div class="flex items-center justify-between">
                            <span class="font-semibold text-gray-800">Formatting & Layout:</span>
                            <span id="scoreFormatting" class="px-3 py-1 bg-blue-200 text-blue-800 rounded-full font-bold text-sm"></span>
                        </div>
                        <p id="commentFormatting" class="text-sm italic text-gray-500 mt-1"></p>
                    </li>
                    <li>
                        <div class="flex items-center justify-between">
                            <span class="font-semibold text-gray-800">Content Strategy:</span>
                            <span id="scoreContent" class="px-3 py-1 bg-blue-200 text-blue-800 rounded-full font-bold text-sm"></span>
                        </div>
                        <p id="commentContent" class="text-sm italic text-gray-500 mt-1"></p>
                    </li>
                    <li>
                        <div class="flex items-center justify-between">
                            <span class="font-semibold text-gray-800">Contact Information:</span>
                            <span id="scoreContact" class="px-3 py-1 bg-blue-200 text-blue-800 rounded-full font-bold text-sm"></span>
                        </div>
                        <p id="commentContact" class="text-sm italic text-gray-500 mt-1"></p>
                    </li>
                </ul>
            </div>
            
            <div class="flex justify-center mt-6">
                <button id="tailoredResumeButton" class="px-6 py-3 rounded-full bg-green-500 text-white font-bold shadow-lg hover:bg-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2">
                    Get Tailored Resume Advice
                </button>
            </div>
        </div>

    </div>

    <script>
        const form = document.getElementById('resumeUploadForm');
        const fileInput = document.getElementById('resumeFile');
        const fileNameSpan = document.getElementById('fileName');
        const loadingMessage = document.getElementById('loadingMessage');
        const statusMessage = document.getElementById('statusMessage');
        const resultsDiv = document.getElementById('results');
        const tailoredResumeButton = document.getElementById('tailoredResumeButton');

        // Update file name display
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileNameSpan.textContent = fileInput.files[0].name;
            } else {
                fileNameSpan.textContent = 'No file selected';
            }
        });

        form.addEventListener('submit', async function(event) {
            event.preventDefault();

            const file = fileInput.files[0];
            if (!file) {
                showStatusMessage('Please select a resume file.', 'text-red-500');
                return;
            }

            // Reset UI
            resultsDiv.classList.add('hidden');
            tailoredResumeButton.classList.add('hidden');
            showStatusMessage('', '');
            loadingMessage.classList.remove('hidden');

            const formData = new FormData();
            formData.append('resume', file);

            try {
                // The URL for the Netlify Function
                const response = await fetch('/.netlify/functions/process-resume', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Something went wrong on the server.');
                }

                const data = await response.json();
                console.log(data); // Log the full response

                // Display Personal Data
                document.getElementById('personalName').textContent = data.personalData.name || 'N/A';
                document.getElementById('personalEmail').textContent = data.personalData.email || 'N/A';
                document.getElementById('personalPhone').textContent = data.personalData.phone || 'N/A';

                // Display Scores and Comments
                document.getElementById('scoreFormatting').textContent = `${data.scores.formatting}/100`;
                document.getElementById('commentFormatting').textContent = data.comments.formatting;
                document.getElementById('scoreContent').textContent = `${data.scores.content}/100`;
                document.getElementById('commentContent').textContent = data.comments.content;
                document.getElementById('scoreContact').textContent = `${data.scores.contact}/100`;
                document.getElementById('commentContact').textContent = data.comments.contact;

                resultsDiv.classList.remove('hidden');
                tailoredResumeButton.classList.remove('hidden');
                
                showStatusMessage('Analysis complete!', 'text-green-500');

                // Set up the mailto link for tailored advice
                tailoredResumeButton.onclick = function() {
                    const subject = encodeURIComponent("Request for Tailored ATS Resume Advice");
                    const body = encodeURIComponent(
                        `Hello REZoom Team,\n\n` +
                        `I would like to request tailored ATS resume advice based on my recent analysis.\n\n` +
                        `My ATS Scores:\n` +
                        `- Formatting & Layout: ${data.scores.formatting}/100\n` +
                        `- Content Strategy: ${data.scores.content}/100\n` +
                        `- Contact Information: ${data.scores.contact}/100\n\n` +
                        `My Personal Data:\n` +
                        `- Name: ${data.personalData.name || 'N/A'}\n` +
                        `- Email: ${data.personalData.email || 'N/A'}\n` +
                        `- Phone: ${data.personalData.phone || 'N/A'}\n\n` +
                        `Please let me know how to proceed.\n\n` +
                        `Thank you!`
                    );
                    window.location.href = `mailto:jabjalib007@gmail.com?subject=${subject}&body=${body}`;
                };

            } catch (error) {
                console.error('Error:', error);
                showStatusMessage(`Error: ${error.message}`, 'text-red-500');
            } finally {
                loadingMessage.classList.add('hidden');
            }
        });

        function showStatusMessage(message, colorClass) {
            statusMessage.textContent = message;
            statusMessage.className = `hidden mt-6 text-center ${colorClass}`;
            if (message) {
                statusMessage.classList.remove('hidden');
            }
        }
    </script>

</body>
</html>
